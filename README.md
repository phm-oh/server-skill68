# IoT Room Monitoring System - DevOps Competition

à¸£à¸°à¸šà¸š IoT à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹à¸‚à¹ˆà¸‡à¸‚à¸±à¸™ DevOps - à¹€à¸£à¸µà¸¢à¸šà¸‡à¹ˆà¸²à¸¢ à¸£à¸§à¸”à¹€à¸£à¹‡à¸§ à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 2 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡

## ğŸ“– à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡

**à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸ªà¸šà¸à¸²à¸£à¸“à¹Œ CI/CD GitLab:** à¸”à¸¹à¹„à¸Ÿà¸¥à¹Œ **[HANDBOOK.md](HANDBOOK.md)** - à¸„à¸¹à¹ˆà¸¡à¸·à¸­ step-by-step à¹à¸šà¸šà¸ˆà¸±à¸šà¸¡à¸·à¸­à¸—à¸³

**HANDBOOK.md** à¸¡à¸µà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸—à¸µà¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸– copy-paste à¹„à¸”à¹‰à¹€à¸¥à¸¢ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¹‚à¸›à¸£à¹à¸à¸£à¸¡ upload file (WinSCP, FileZilla) - à¹ƒà¸Šà¹‰ SSH à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™

## ğŸ“‹ à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š

### Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VM1 (192.168.100.101) - GitLab + CI/CD + Monitoring        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - GitLab CE (Port 80)                                       â”‚
â”‚ - GitLab Runner (CI/CD)                                     â”‚
â”‚ - Container Registry (Port 5050)                            â”‚
â”‚ - Prometheus (Port 9090)                                    â”‚
â”‚ - Grafana (Port 3000)                                       â”‚
â”‚ - Portainer (Port 9000)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Deploy Images
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VM2 (192.168.100.102) - Production Server                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Caddy (Reverse Proxy, Port 80)                            â”‚
â”‚ - Backend Node.js (Port 3000)                               â”‚
â”‚ - Frontend Vue.js (Port 80 via Caddy)                      â”‚
â”‚ - MariaDB (Port 3306)                                       â”‚
â”‚ - phpMyAdmin (Port 8081)                                    â”‚
â”‚ - MQTT Mosquitto (Port 1883)                               â”‚
â”‚ - Node-RED (Port 1880)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–²
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚   ESP32-1   â”‚  â”‚   ESP32-2   â”‚
            â”‚   (Room 1)   â”‚  â”‚   (Room 2)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   ESP32-3    â”‚
                    â”‚   (Room 3)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start

### VM1 Setup (GitLab + CI/CD)

```bash
cd gitlab-devops
chmod +x setup.sh
./setup.sh
```

**à¸£à¸­ GitLab boot (5-10 à¸™à¸²à¸—à¸µ) à¹à¸¥à¹‰à¸§:**
1. Login: http://192.168.100.101
   - Username: `root`
   - Password: `DevOps@2024!`
2. Register Runner:
   ```bash
   docker exec -it gitlab-runner gitlab-runner register
   # URL: http://192.168.100.101
   # Token: à¸ˆà¸²à¸ GitLab â†’ Admin â†’ CI/CD â†’ Runners
   # Executor: docker
   # Image: alpine:latest
   ```

### VM2 Setup (Production)

```bash
cd vm2-production
chmod +x setup.sh
./setup.sh
```

**à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸ push images à¸ˆà¸²à¸ GitLab:**
```bash
docker compose pull
docker compose up -d
```

## ğŸ“± ESP32 Code

à¸”à¸¹à¹„à¸Ÿà¸¥à¹Œ `ESP32/esp32-room.ino` à¸ªà¸³à¸«à¸£à¸±à¸šà¹‚à¸„à¹‰à¸”à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡

**WiFi SSID:** `udvcit`  
**MQTT Topics:**
- `room1/temperature` (ESP32-ROOM1)
- `room2/temperature` (ESP32-ROOM2)
- `room3/temperature` (ESP32-ROOM3)

**MQTT Message Format:**
```json
{
  "temp": 25.5,
  "humidity": 60.0
}
```

## ğŸ” Default Credentials

| Service | URL | Username | Password |
|---------|-----|----------|----------|
| GitLab | http://192.168.100.101 | root | DevOps@2024! |
| Grafana | http://192.168.100.101:3000 | admin | admin123 |
| Frontend | http://192.168.100.102 | admin | admin123 |
| phpMyAdmin | http://192.168.100.102:8081 | root | root123 |
| Node-RED | http://192.168.100.102:1880 | admin | admin123 |

## ğŸ“Š Database Schema

- **users**: à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (admin/user)
- **rooms**: 3 à¸«à¹‰à¸­à¸‡ (Room 1, 2, 3)
- **user_rooms**: User à¹€à¸«à¹‡à¸™à¸«à¹‰à¸­à¸‡à¹„à¸«à¸™à¸šà¹‰à¸²à¸‡
- **temperatures**: à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´
- **room_images**: à¸£à¸¹à¸›à¸ à¸²à¸à¸›à¸£à¸°à¸ˆà¸³à¸«à¹‰à¸­à¸‡

## ğŸ”§ Troubleshooting

### GitLab Login à¹„à¸¡à¹ˆà¹„à¸”à¹‰
```bash
docker exec -it gitlab gitlab-rake "gitlab:password:reset[root]"
# à¸£à¸­ 30-60 à¸§à¸´à¸™à¸²à¸—à¸µ à¹à¸¥à¹‰à¸§à¹ƒà¸ªà¹ˆ password à¹ƒà¸«à¸¡à¹ˆ
```

### Runner à¹„à¸¡à¹ˆ build à¹„à¸”à¹‰
```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š privileged mode
docker exec gitlab-runner cat /etc/gitlab-runner/config.toml
# à¸•à¹‰à¸­à¸‡à¸¡à¸µ privileged = true
```

### Pull image à¹„à¸¡à¹ˆà¹„à¸”à¹‰
```bash
# à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š insecure-registry
docker info | grep -A 5 "Insecure"
# Login à¹ƒà¸«à¸¡à¹ˆ
docker login 192.168.100.101:5050
```

## ğŸ“ Notes

- à¹ƒà¸Šà¹‰ Docker à¸ˆà¸²à¸ Ubuntu repository (à¸‡à¹ˆà¸²à¸¢ à¹€à¸£à¹‡à¸§)
- à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰ HTTPS/SSL (à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸‚à¹ˆà¸‡)
- Hardcoded IPs à¹à¸¥à¸° passwords (à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§)
- à¸£à¸°à¸šà¸šà¹€à¸£à¸µà¸¢à¸šà¸‡à¹ˆà¸²à¸¢ à¸ˆà¸³à¸‡à¹ˆà¸²à¸¢ à¹ƒà¸Šà¹‰à¹€à¸§à¸¥à¸²à¹„à¸¡à¹ˆà¹€à¸à¸´à¸™ 2 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡


